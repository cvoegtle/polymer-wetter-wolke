<dom-module id="wetter-location">
  <style>
    :host {
      display: block;
      --wetter-caption-color: black;
    }

    @media (max-width: 600px) {
    }
  </style>
  <template>
    <wetter-caption location="[[weatherdata.location]]"
                    timestamp="[[timeFraction(weatherdata.timestamp)]]" expanded="false"></wetter-caption>
    <wetter-line label="Temperatur:" data="[[format(weatherdata.temperature,'Â°C')]]"></wetter-line>
    <wetter-line label="Luftfeuchtigkeit:" data="[[format(weatherdata.humidity, '%')]]"></wetter-line>
    <template is="dom-if" if="[[weatherdata.rain]]">
      <wetter-line label=" Regen letzte Stunde:" data="[[format(weatherdata.rain, 'l')]]"></wetter-line>
    </template>
    <template is="dom-if" if="[[weatherdata.rain_today]]">
      <wetter-line label="Regen:" data="[[format(weatherdata.rain_today, 'l')]]"></wetter-line>
    </template>
    <template is="dom-if" if="[[weatherdata.watt]]">
      <wetter-line label="Solarleistung:" data="[[format(weatherdata.watt, 'W')]]"></wetter-line>
    </template>
  </template>
</dom-module>
<script>
  (function () {
    Polymer({
      is: 'wetter-location',

      properties: {
        weatherdata: Object
      },

      format: function (value, unit) {
        if (value !== '') {
          var result = value.toFixed(1);
          return result.replace('.', ',') + ' ' + unit;

        } else {
          return '';
        }
      },

      timeFraction: function (dateAsString) {
        var date = new Date(dateAsString);

        var age = (new Date().getTime() - date.getTime()) / 1000 / 60;
        this.customStyle['--wetter-caption-color'] = (age < 20 ? 'black' : 'red');
        this.updateStyles();

        var hours = date.getHours();
        var minutes = date.getMinutes();

        return hours + ':' + (minutes < 10 ? '0' + minutes : minutes);
      }

    });
  })();
</script>

